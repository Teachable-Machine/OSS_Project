<!DOCTYPE html>
<html lang="ko" >
  <head>
    <title>당신의 두발은 건강하신가요?</title>
    <meta charset="UTF-8" />
    <script defer src="src/drag_and_drop.js"></script>
  </head>
  <body>
    <div id="drop-area">
      <link rel="stylesheet" href="drop-area.css">
      <form class="my-drag-form">
        <p>이미지 파일 업로드</p>
        <!-- 
        <input type="file" id="fileElem" multiple accept="image/*" 
        onchange="handleFiles(this.files)"> 
        -->
        <input type="file" id="fileElem"  accept="image/*">
        <label class="button" for="fileElem">select some files</label>
      </form>
      <progress id="progress-bar" max=100 value=0></progress>
      <button type="button" onclick="init()">예측</button>
      <input type = "button" value = "상세정보 보기" onclick  = "movepage()"/>
      <div id="gallery"></div>
      
    </div>
    <div id="label-container"></div>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
      <script type="text/javascript">
                // More API functions here:
                // https://github.com/googlecreativelab/teachablemachine-community/tree/master/libraries/image
     
                // the link to your model provided by Teachable Machine export panel
                const URL = 'https://teachablemachine.withgoogle.com/models/Vpg24Z3dA/';
     
                let model, webcam, labelContainer, maxPredictions;
     
                // Load the image model and setup the webcam
                async function init() {
                    const modelURL = URL + 'model.json';
                    const metadataURL = URL + 'metadata.json';
     
                    // load the model and metadata
                    // Refer to tmImage.loadFromFiles() in the API to support files from a file picker
                    // or files from your local hard drive
                    // Note: the pose library adds "tmImage" object to your window (window.tmImage)
                    model = await tmImage.load(modelURL, metadataURL);
                    maxPredictions = model.getTotalClasses();
     
                    labelContainer = document.getElementById('label-container');
                    for (let i = 0; i < maxPredictions; i++) {
                        // and class labels
                        labelContainer.appendChild(document.createElement('div'));
                    }

                    var image = document.getElementById('fileElem');
                    const prediction = await model.predict(image, false);
                    for (let i = 0; i < maxPredictions; i++) {
                        const classPrediction =
                            prediction[i].className + ': ' + prediction[i].probability.toFixed(2)*100 + "%";
                        labelContainer.childNodes[i].innerHTML = classPrediction;
                    }
                }

                function movepage(){
        location.href = "/information.js";
      }
            </script>
  </body>
</html>